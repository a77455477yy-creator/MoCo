<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>åœ°ç†ä½ç½®èˆ‡æ¬Šé™æª¢æŸ¥</title>
</head>
<body>

    <h1>ğŸŒ ç•¶å‰åœ°ç†ä½ç½®è³‡è¨Š</h1>
    
    <p>æœå‹™ç‹€æ…‹: <span id="service-status">æ­£åœ¨æª¢æŸ¥æœå‹™æ”¯æ´...</span></p>
    <p>æ¬Šé™ç‹€æ…‹: <span id="permission-status">æ­£åœ¨æª¢æŸ¥æ¬Šé™...</span></p>
    
    <hr>
    
    <p>ç·¯åº¦ (Latitude): <span id="latitude-value">ç­‰å¾…è®€å–...</span></p>
    <p>ç¶“åº¦ (Longitude): <span id="longitude-value">ç­‰å¾…è®€å–...</span></p>

    <script>
        // å–å¾— HTML å…ƒç´ 
        const serviceStatusElement = document.getElementById('service-status');
        const permissionStatusElement = document.getElementById('permission-status');
        const latElement = document.getElementById('latitude-value');
        const lonElement = document.getElementById('longitude-value');

        /**
         * è™•ç†ä½ç½®ç²å–æˆåŠŸ
         */
        function handlePosition(position) {
            const coords = position.coords;
            
            latElement.textContent = coords.latitude;
            lonElement.textContent = coords.longitude;

            serviceStatusElement.textContent = "âœ… ä½ç½®è®€å–æˆåŠŸï¼";
        }

        /**
         * è™•ç†ä½ç½®ç²å–å¤±æ•—
         */
        function handlePositionError(error) {
            let errorMessage = "ä½ç½®è®€å–å¤±æ•—ã€‚";
            
            // æ ¹æ“šéŒ¯èª¤ä»£ç¢¼çµ¦å‡ºå…·é«”æç¤º
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    // å¦‚æœç”¨æˆ¶åœ¨å½ˆçª—ä¸­æ‹’çµ•ï¼Œæœƒé€²å…¥é€™è£¡
                    errorMessage += "ä½¿ç”¨è€…æ‹’çµ•äº†è«‹æ±‚ï¼Œè«‹æª¢æŸ¥ã€Œæ¬Šé™ç‹€æ…‹ã€æç¤ºã€‚";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += "ä½ç½®è³‡è¨Šç„¡æ³•å–å¾— (ä¾‹å¦‚ GPS è¨Šè™Ÿå·®)ã€‚";
                    break;
                case error.TIMEOUT:
                    errorMessage += "ç­‰å¾…ä½ç½®è³‡è¨Šè¶…æ™‚ã€‚";
                    break;
                default:
                    errorMessage += `ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ (ä»£ç¢¼: ${error.code})ã€‚`;
            }

            serviceStatusElement.textContent = `âŒ ${errorMessage}`;
            latElement.textContent = "ç„¡æ³•å–å¾—";
            lonElement.textContent = "ç„¡æ³•å–å¾—";
            console.error("ä½ç½®è®€å–å¤±æ•—:", error);
        }
        
        /**
         * æª¢æŸ¥ Geolocation æ¬Šé™ç‹€æ…‹
         */
        async function checkPermissionStatus() {
             // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´æ–°çš„ Permissions API
            if (!navigator.permissions) {
                permissionStatusElement.textContent = "âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´æ¬Šé™æª¢æŸ¥ APIï¼Œç›´æ¥å˜—è©¦ç²å–ä½ç½®ã€‚";
                return;
            }

            try {
                // æŸ¥è©¢ geolocation çš„æ¬Šé™ç‹€æ…‹
                const permission = await navigator.permissions.query({ name: 'geolocation' });

                // æ ¹æ“šç‹€æ…‹æ›´æ–°ç¶²é æ–‡å­—
                permissionStatusElement.textContent = `ç‹€æ…‹: ${permission.state}`;

                // æ ¹æ“šæ¬Šé™ç‹€æ…‹çµ¦å‡ºæ“ä½œæç¤º
                if (permission.state === 'granted') {
                    permissionStatusElement.textContent += " (å·²å…è¨±)";
                } else if (permission.state === 'denied') {
                    permissionStatusElement.textContent += " (âŒ å·²æ‹’çµ•ï¼è«‹æ‰‹å‹•åœ¨ç€è¦½å™¨è¨­å®šä¸­å•Ÿç”¨)";
                } else if (permission.state === 'prompt') {
                    permissionStatusElement.textContent += " (â— éœ€è¦æ‚¨çš„é»æ“Šç¢ºèª)";
                }
                
                // ç›£è½æ¬Šé™ç‹€æ…‹è®ŠåŒ– (é¸ç”¨)
                permission.onchange = () => {
                    permissionStatusElement.textContent = `ç‹€æ…‹å·²è®Šæ›´ç‚º: ${permission.state}`;
                };

            } catch (e) {
                permissionStatusElement.textContent = "âš ï¸ æ¬Šé™æª¢æŸ¥å¤±æ•—æˆ–å¯èƒ½ä¸è¢«æ”¯æ´ã€‚";
                console.error("æ¬Šé™æª¢æŸ¥éŒ¯èª¤:", e);
            }
        }

        /**
         * æª¢æŸ¥ç€è¦½å™¨æ”¯æ´ä¸¦å–å¾—ç•¶å‰ä½ç½®
         */
        function getGeolocation() {
            if ("geolocation" in navigator) {
                serviceStatusElement.textContent = "ğŸ‘ åœ°ç†ä½ç½®æœå‹™å¯ç”¨ï¼Œæ­£åœ¨è«‹æ±‚ä½ç½®...";
                
                // 1. å…ˆæª¢æŸ¥æ¬Šé™ç‹€æ…‹ï¼Œè®“ä½¿ç”¨è€…çŸ¥é“å•é¡Œåœ¨å“ª
                checkPermissionStatus();

                // 2. å–å¾—ç•¶å‰ä½ç½®ï¼Œé€™æœƒè§¸ç™¼ç€è¦½å™¨çš„å½ˆçª—è«‹æ±‚
                navigator.geolocation.getCurrentPosition(
                    handlePosition,  
                    handlePositionError 
                );
            } else {
                serviceStatusElement.textContent = "ğŸ‘ åœ°ç†ä½ç½®æœå‹™ä¸å¯ç”¨ã€‚";
                permissionStatusElement.textContent = "ä¸é©ç”¨";
                latElement.textContent = "ä¸æ”¯æ´";
                lonElement.textContent = "ä¸æ”¯æ´";
            }
        }

        // é é¢è¼‰å…¥å¾ŒåŸ·è¡Œ
        getGeolocation();
    </script>
</body>
</html>