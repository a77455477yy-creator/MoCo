<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œå‹•ç¶²è·¯å“è³ªå¯¦æ¸¬</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #121212; color: #ffffff; padding: 20px; text-align: center; }
        .container { max-width: 400px; margin: 0 auto; }
        
        /* è¨Šè™Ÿç‡ˆè¨­è¨ˆ */
        .signal-circle {
            width: 150px; height: 150px;
            border-radius: 50%;
            border: 5px solid #333;
            margin: 30px auto;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        
        .value { font-size: 36px; font-weight: bold; }
        .unit { font-size: 14px; color: #aaa; }
        .label { font-size: 16px; margin-bottom: 5px; color: #ccc; }

        /* é¡è‰²ç‹€æ…‹ */
        .status-good { border-color: #00ff00; box-shadow: 0 0 30px #00ff00; color: #00ff00; }
        .status-fair { border-color: #ffcc00; box-shadow: 0 0 30px #ffcc00; color: #ffcc00; }
        .status-bad { border-color: #ff0000; box-shadow: 0 0 30px #ff0000; color: #ff0000; }

        /* GPS å€å¡Š */
        .gps-box { background: #1e1e1e; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: left; font-size: 14px; color: #bbb; border: 1px solid #333; }
        .btn { background: #007aff; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 16px; margin-top: 20px; cursor: pointer; }
        .btn:active { opacity: 0.8; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ“¡ ç¶²è·¯å“è³ªå¯¦æ¸¬å„€</h2>
        <p style="font-size: 12px; color: #888;">(ä»¥é€£ç·šå»¶é²ä»£æ›¿è¨Šè™Ÿå¼·åº¦)</p>

        <div id="signalCircle" class="signal-circle">
            <div class="label">Ping å»¶é²</div>
            <div id="pingValue" class="value">--</div>
            <div class="unit">æ¯«ç§’ (ms)</div>
        </div>

        <div id="statusText" style="font-weight: bold; margin-bottom: 20px;">æº–å‚™æ¸¬è©¦...</div>

        <button class="btn" onclick="startTest()">ğŸš€ é–‹å§‹é€£çºŒæ¸¬è©¦</button>

        <div class="gps-box">
            <div><strong>ğŸ“ ç¶“åº¦ï¼š</strong> <span id="lon">ç­‰å¾…ä¸­...</span></div>
            <div><strong>ğŸ“ ç·¯åº¦ï¼š</strong> <span id="lat">ç­‰å¾…ä¸­...</span></div>
            <div><strong>ğŸ¯ ç²¾ç¢ºåº¦ï¼š</strong> <span id="acc">--</span></div>
            <div style="margin-top:5px; font-size:10px; color:#666;">(è«‹å…è¨±ç€è¦½å™¨å­˜å–ä½ç½®)</div>
        </div>
    </div>

    <script>
        // 1. æ¸¬é‡ Ping (ç¶²è·¯å“è³ª)
        async function measurePing() {
            const start = performance.now();
            try {
                // å˜—è©¦æŠ“å–ä¸€å€‹éå¸¸å°çš„æª”æ¡ˆ (é€™è£¡ç”¨ Google çš„åœ–ç¤ºï¼Œé€™æ˜¯ä¸€å€‹æ¨™æº–çš„ç¶²è·¯æ¸¬è©¦æ–¹æ³•)
                // mode: 'no-cors' å…è¨±æˆ‘å€‘ç™¼é€è«‹æ±‚å³ä½¿è·¨åŸŸ (é›–ç„¶è®€ä¸åˆ°å…§å®¹ï¼Œä½†å¯ä»¥è¨ˆç®—æ™‚é–“)
                await fetch('https://www.google.com/images/branding/googlelogo/2x/googlelogo_light_color_92x30dp.png', { 
                    mode: 'no-cors',
                    cache: 'no-store' 
                });
                const end = performance.now();
                return Math.round(end - start);
            } catch (e) {
                return -1; // é€£ç·šå¤±æ•—
            }
        }

        // 2. æ›´æ–°ç•«é¢
        function updateDisplay(ping) {
            const circle = document.getElementById('signalCircle');
            const valText = document.getElementById('pingValue');
            const statusText = document.getElementById('statusText');

            if (ping === -1) {
                valText.innerText = "æ–·ç·š";
                circle.className = "signal-circle status-bad";
                statusText.innerText = "ç„¡æ³•é€£ç·š";
                return;
            }

            valText.innerText = ping;

            // åˆ¤æ–·è¨Šè™Ÿå“è³ªé‚è¼¯
            if (ping < 100) {
                // å»¶é²ä½æ–¼ 100ms -> è¨Šè™Ÿå¥½
                circle.className = "signal-circle status-good";
                statusText.innerText = "è¨Šè™Ÿå“è³ªï¼šå„ªç•° (4G/5G/WiFi)";
                statusText.style.color = "#00ff00";
            } else if (ping < 300) {
                // å»¶é² 100-300ms -> æ™®é€š
                circle.className = "signal-circle status-fair";
                statusText.innerText = "è¨Šè™Ÿå“è³ªï¼šæ™®é€š";
                statusText.style.color = "#ffcc00";
            } else {
                // å»¶é²é«˜æ–¼ 300ms -> å·®
                circle.className = "signal-circle status-bad";
                statusText.innerText = "è¨Šè™Ÿå“è³ªï¼šå·® / å£…å¡";
                statusText.style.color = "#ff0000";
            }
        }

        // 3. ç²å– GPS
        function getGPS() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('lat').innerText = position.coords.latitude.toFixed(5);
                        document.getElementById('lon').innerText = position.coords.longitude.toFixed(5);
                        document.getElementById('acc').innerText = "èª¤å·® " + Math.round(position.coords.accuracy) + " å…¬å°º";
                    },
                    (error) => {
                        document.getElementById('lat').innerText = "ç„¡æ³•ç²å–";
                    }
                );
            }
        }

        // 4. ä¸»ç¨‹å¼è¿´åœˆ
        let isRunning = false;
        async function startTest() {
            if (isRunning) return;
            isRunning = true;
            document.querySelector('.btn').innerText = "æ¸¬é‡ä¸­ (ç§»å‹•æ‰‹æ©Ÿè§€å¯Ÿè®ŠåŒ–)...";
            
            // å•Ÿå‹• GPS
            getGPS();
            setInterval(getGPS, 5000); // æ¯5ç§’æ›´æ–°ä¸€æ¬¡ä½ç½®

            // å•Ÿå‹• Ping æ¸¬è©¦ (æ¨¡æ“¬å³æ™‚è¨Šè™Ÿè®ŠåŒ–)
            while (true) {
                const ping = await measurePing();
                updateDisplay(ping);
                // ä¼‘æ¯ 1 ç§’å†æ¸¬ä¸‹ä¸€æ¬¡ï¼Œé¿å…æŠŠç¶²è·¯å¡çˆ†
                await new Promise(r => setTimeout(r, 1000));
            }
        }
    </script>
</body>
</html>
