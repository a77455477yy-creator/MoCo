<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œå‹•ç¶²è·¯å“è³ªå¯¦æ¸¬ (å¯åœæ­¢ç‰ˆ)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #121212; color: #ffffff; padding: 20px; text-align: center; }
        .container { max-width: 400px; margin: 0 auto; }
        
        .signal-circle {
            width: 150px; height: 150px;
            border-radius: 50%;
            border: 5px solid #444; /* é è¨­ç°è‰² */
            margin: 30px auto;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .value { font-size: 36px; font-weight: bold; }
        .unit { font-size: 14px; color: #aaa; }
        .label { font-size: 16px; margin-bottom: 5px; color: #ccc; }

        .status-good { border-color: #00ff00; box-shadow: 0 0 30px #00ff00; color: #00ff00; }
        .status-fair { border-color: #ffcc00; box-shadow: 0 0 30px #ffcc00; color: #ffcc00; }
        .status-bad { border-color: #ff0000; box-shadow: 0 0 30px #ff0000; color: #ff0000; }
        .status-off { border-color: #444; color: #666; box-shadow: none;}

        .gps-box { background: #1e1e1e; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: left; font-size: 14px; color: #bbb; border: 1px solid #333; }
        
        /* æŒ‰éˆ•æ¨£å¼å„ªåŒ– */
        .btn { border: none; padding: 12px 30px; border-radius: 25px; font-size: 16px; margin-top: 20px; cursor: pointer; width: 80%; transition: 0.3s; }
        .btn-start { background: #007aff; color: white; }
        .btn-stop { background: #ff3b30; color: white; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ“¡ ç¶²è·¯å“è³ªå¯¦æ¸¬å„€</h2>
        <p style="font-size: 12px; color: #888;">(ä»¥é€£ç·šå»¶é²ä»£æ›¿è¨Šè™Ÿå¼·åº¦)</p>

        <div id="signalCircle" class="signal-circle status-off">
            <div class="label">Ping å»¶é²</div>
            <div id="pingValue" class="value">--</div>
            <div class="unit">æ¯«ç§’ (ms)</div>
        </div>

        <div id="statusText" style="font-weight: bold; margin-bottom: 20px; color: #888;">è«‹é»æ“Šé–‹å§‹æ¸¬è©¦</div>

        <button id="actionBtn" class="btn btn-start" onclick="toggleTest()">ğŸš€ é–‹å§‹æ¸¬è©¦</button>

        <div class="gps-box">
            <div><strong>ğŸ“ ç¶“åº¦ï¼š</strong> <span id="lon">--</span></div>
            <div><strong>ğŸ“ ç·¯åº¦ï¼š</strong> <span id="lat">--</span></div>
            <div><strong>ğŸ¯ ç²¾ç¢ºåº¦ï¼š</strong> <span id="acc">--</span></div>
        </div>
    </div>

    <script>
        let isRunning = false;
        let gpsInterval = null;

        // 1. æ¸¬é‡ Ping
        async function measurePing() {
            const start = performance.now();
            try {
                await fetch('https://www.google.com/images/branding/googlelogo/2x/googlelogo_light_color_92x30dp.png', { 
                    mode: 'no-cors', cache: 'no-store' 
                });
                return Math.round(performance.now() - start);
            } catch (e) { return -1; }
        }

        // 2. æ›´æ–°ç•«é¢
        function updateDisplay(ping) {
            const circle = document.getElementById('signalCircle');
            const valText = document.getElementById('pingValue');
            const statusText = document.getElementById('statusText');

            if (!isRunning) return; // å¦‚æœå·²ç¶“åœæ­¢ï¼Œå°±ä¸è¦æ›´æ–°ç•«é¢äº†

            if (ping === -1) {
                valText.innerText = "æ–·ç·š";
                circle.className = "signal-circle status-bad";
                statusText.innerText = "ç„¡æ³•é€£ç·š";
                return;
            }

            valText.innerText = ping;

            if (ping < 100) {
                circle.className = "signal-circle status-good";
                statusText.innerText = "è¨Šè™Ÿå“è³ªï¼šå„ªç•°";
                statusText.style.color = "#00ff00";
            } else if (ping < 300) {
                circle.className = "signal-circle status-fair";
                statusText.innerText = "è¨Šè™Ÿå“è³ªï¼šæ™®é€š";
                statusText.style.color = "#ffcc00";
            } else {
                circle.className = "signal-circle status-bad";
                statusText.innerText = "è¨Šè™Ÿå“è³ªï¼šå·® / å£…å¡";
                statusText.style.color = "#ff0000";
            }
        }

        // 3. ç²å– GPS
        function getGPS() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('lat').innerText = position.coords.latitude.toFixed(5);
                        document.getElementById('lon').innerText = position.coords.longitude.toFixed(5);
                        document.getElementById('acc').innerText = "èª¤å·® " + Math.round(position.coords.accuracy) + "m";
                    },
                    (error) => { console.log("GPS Error"); }
                );
            }
        }

        // 4. é–‹é—œæ§åˆ¶é‚è¼¯ (æ ¸å¿ƒä¿®æ”¹)
        async function toggleTest() {
            const btn = document.getElementById('actionBtn');
            const circle = document.getElementById('signalCircle');
            const statusText = document.getElementById('statusText');

            if (isRunning) {
                // === åŸ·è¡Œåœæ­¢ ===
                isRunning = false;
                btn.innerText = "ğŸš€ é–‹å§‹æ¸¬è©¦";
                btn.className = "btn btn-start";
                
                // åœæ­¢ GPS æ›´æ–°
                clearInterval(gpsInterval);
                
                // æ¢å¾©å¾…æ©Ÿç•«é¢
                circle.className = "signal-circle status-off";
                statusText.innerText = "å·²åœæ­¢æ¸¬è©¦";
                statusText.style.color = "#888";
                document.getElementById('pingValue').innerText = "--";

            } else {
                // === åŸ·è¡Œé–‹å§‹ ===
                isRunning = true;
                btn.innerText = "ğŸ›‘ åœæ­¢æ¸¬è©¦";
                btn.className = "btn btn-stop";
                statusText.innerText = "é€£ç·šåˆå§‹åŒ–ä¸­...";
                
                // å•Ÿå‹• GPS
                getGPS();
                gpsInterval = setInterval(getGPS, 5000);

                // å•Ÿå‹• Ping è¿´åœˆ
                while (isRunning) {
                    const ping = await measurePing();
                    if(isRunning) { // å†æ¬¡æª¢æŸ¥ç¢ºä¿æ²’æœ‰åœ¨ç­‰å¾…æ™‚è¢«æŒ‰åœæ­¢
                        updateDisplay(ping);
                        await new Promise(r => setTimeout(r, 1000)); // ç­‰ä¸€ç§’
                    }
                }
            }
        }
    </script>
</body>
</html>
